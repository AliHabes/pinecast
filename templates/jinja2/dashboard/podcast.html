{% extends 'dashboard_base.html' %}
{% block dashboard_body %}

<menu class="toolbar toolbar-right">
  <li><a class="btn" href="{{ url('new_episode', kwargs={'podcast_slug': podcast.slug}) }}">New Episode</a></li>
  <li><a class="btn btn-neutral" href="{{ url('edit_podcast', kwargs={'podcast_slug': podcast.slug}) }}">Edit</a></li>
</menu>

<h1>{{ podcast.name }}</h1>
<div class="chunky-row">
  <div class="total-listens">
    <strong>{{ analytics.total_listens }}</strong>
    <span>Total Listens</span>
  </div>
  <div class="this-week">
    <strong>{{ analytics.total_listens_this_week }}</strong>
    <span>Listens This Week</span>
  </div>
  <div class="total-subscribers">
    <strong>{{ analytics.subscribers }}</strong>
    <span>{{ plural('Subscriber', 'Subscribers', analytics.subscribers) }}</span>
  </div>
</div>

{% if episodes %}
  <div class="chunky">
    <div class="chart-placeholder"
      data-type="podcast-listen-history"
      data-podcast="{{ podcast.slug }}"
      data-title="Listen history"
      data-chart-type="line"></div>

    <menu class="toolbar">
      <li><a class="btn" href="{{ url('podcast_geo', kwargs={'podcast_slug': podcast.slug}) }}">Geo</a></li>
      <li><a class="btn" href="{{ url('top_episodes', kwargs={'podcast_slug': podcast.slug}) }}">Top Episodes</a></li>
    </menu>
  </div>
{% endif %}


<div class="url-box">
  <input type="url"
    title="RSS Feed"
    readonly
    value="http://host.podmaster.io{{ url('feed', kwargs={'podcast_slug': podcast.slug}) }}"
    class="width-full">
</div>

{% if episodes %}
  <table>
    <thead>
      <tr>
        <th class="primary">Episode Name</th>
        <th>Subtitle</th>
      </tr>
    </thead>
    <tbody>
      {% for ep in episodes %}
        <tr>
          <td class="primary">
            <a href="/dashboard/podcast/{{ podcast.slug }}/episode/{{ ep.id }}">{{ ep.title }}</a>
          </td>
          <td>{{ ep.subtitle }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="chunky-row">
    <div class="chart-placeholder"
      data-type="podcast-listen-breakdown"
      data-podcast="{{ podcast.slug }}"
      data-title="Breakdown of listens by source"
      data-chart-type="pie"></div>

    <div class="chunkier chart-placeholder"
      data-type="podcast-subscriber-history"
      data-podcast="{{ podcast.slug }}"
      data-title="Subscriber history"
      data-chart-type="line"></div>
  </div>

  <div class="chunky-row">
    <div class="chart-placeholder"
      data-type="podcast-listen-platform-breakdown"
      data-podcast="{{ podcast.slug }}"
      data-extra="breakdown_type=device"
      data-title="Breakdown of listens by device"
      data-chart-type="pie"></div>

    <div class="chart-placeholder"
      data-type="podcast-listen-platform-breakdown"
      data-podcast="{{ podcast.slug }}"
      data-extra="breakdown_type=browser"
      data-title="Breakdown of listens by browser"
      data-chart-type="pie"></div>

    <div class="chart-placeholder"
      data-type="podcast-listen-platform-breakdown"
      data-podcast="{{ podcast.slug }}"
      data-extra="breakdown_type=os"
      data-title="Breakdown of listens by os"
      data-chart-type="pie"></div>
  </div>

{% else %}
  <div class="episode-empty-state empty-state">
    You haven't uploaded any episodes yet.<br>
    <a class="btn" href="{{ url('new_episode', kwargs={'podcast_slug': podcast.slug})}}">Upload One Now</a>
  </div>
{% endif %}

{% endblock %}

{% block after_content %}
<script src="https://fb.me/react-0.13.3.js"></script>
<script src="/static/js/chartjs-1.0.2.min.js"></script>
<script src="/static/js/ui-chart.js"></script>
{% endblock %}
